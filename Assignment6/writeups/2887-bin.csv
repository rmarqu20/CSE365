2887-bin,1,I played Codegate 2016 Quals last week with our team BabyPhD
2887-bin,2,"Although I couldn't solve many tasks :(, the CTF is quite fun to play :3"
2887-bin,3,We are given a nice-looking small x86 Linux binary that reads our name and let us play lotto
2887-bin,4,"After loading up the binary in IDA, we found a obvious format string vulnerability:"
2887-bin,5,"But in order to execute this part, we have to correctly guess 6 numbers that the program generated with glibc's rand() function"
2887-bin,6,"After some more examination, we can see that the program reads 4 bytes from /dev/urandom to a buffer lies right after our name buffer on the stack:"
2887-bin,7,"After that, 6 numbers will be generated by this formula: val = rand() % 45 + 1, and they must be pairwise different"
2887-bin,8,"Thanks to seed's memory address on the stack, we can easily leak seed's value by filling the name buffer with some non-null character"
2887-bin,9,"Due to how C handles strings (a string must be terminated with a null byte), the whole seed value will be printed along with our ""name"" if it doesn't contain any null bytes"
2887-bin,10,I used foresight to generate rand() values in Python
2887-bin,11,"My code will throw EOFError sometimes when it couldn't recover the seed or somehow it can't generate the right answer, so I had to run it several times :("
2887-bin,12,"After passing the lotto check, everything is quite straightforward"
2887-bin,13,"The program will call exit(0) after calling printf(), so we can control the instruction pointer by overwriting its entry in the GOT"
2887-bin,14,"Try to retrieve some stack addresses on the remote server, we can see that ASLR is turned on, so we'll need to leak some addresses first in order to know the libc version and then calculate system() address."
2887-bin,15,We can use %s to read values at a specific memory address
2887-bin,16,I'll retrieve the addresses of putchar() and rand() in libc by reading their GOT entries
2887-bin,17,"Because the binary is not a PIE, all of its addresses are fixed just like in IDA"
2887-bin,18,I overwrote exit() with 0x0804883D so that we won't need to calculate rand() values again
2887-bin,19,Libc's version on the remote server is the same as my libc's version (Ubuntu 15.10).
2887-bin,20,"In the second stage, I overwrote printf() with the address of system(), supply /bin/sh in the format string and then overwrote exit() to call system() in order to get shell"
2887-bin,21,"Thanks to the binjitsu library, I can generate format string payloads faster :3"
2887-bin,22,Here is my code:
2887-bin,23,"The flag file stays in /home/bugbug/, and the flag is SOur_cr3am&oni0n."
2887-bin,24,Hatena-Epic-has-related-entries-with-elasticsearch:true
2887-bin,25,Related Entry
2887-bin,26,"We are given a Golang binary, which my idol teammate @yeuch..."
2887-bin,27,"When I read this problem, I was thinking about Edmonds' alg..."
2887-bin,28,We are asked to calculate the number of ways to make a vali...
2887-bin,29,We are given a 7-zip archive that contains a lot of smaller...
2887-bin,30,Read more
2887-bin,31,Write a comment
2887-bin,32,Subscribed
2887-bin,33,Subscribe
2887-bin,34,Subscribe
2887-bin,35,Start using Hatena Blog!
2887-bin,36,dakutenpura is using Hatena Blog
2887-bin,37,Would you like to try it too?
2887-bin,38,Start using Hatena Blog (Free)
2887-bin,39,What is Hatena Blog?
2887-bin,40,Powered by Hatena Blog
2887-bin,41,Star added
2887-bin,42,Quote saved.
2887-bin,43,View saved quotes
2887-bin,44,Login to quote this blog
2887-bin,45,Failed to save quote
2887-bin,46,Please try again later.
2887-bin,47,You cannot quote because this article is private.
2887-bin,48,Subscribed
2887-bin,49,Subscribe
2887-bin,50,Subscribe
